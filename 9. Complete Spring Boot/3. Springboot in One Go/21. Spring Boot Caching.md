# Spring Boot Caching


Topics -
1. What is Cache ?
2. Why Cache ?
3. Implementation of Cache in Spring Boot 
    - 3.1. Enable Caching
    - 3.2 Use Cache in Service Layer
    - @EnableCaching
    - @Cacheable
    - @CachePut
    - @CacheEvict
4. How to check the Cache
5. Types of Cache
    - 5.1 In Memory Cache
    - 5.2 Distributed Cache
    




## 1. What is Cache ?
At a high level, a cache is a temporary storage area used to keep frequently accessed data in a faster medium, so future requests for the same data can be served more quickly without recomputing or refetching from a slower source (like a database, disk, or network).



## 2. Why Cache ?

**Reduce Latency** - Faster access to data compared to fetch from db or an external service.

**Decrease Load** - Reduce the number of calls to the backend or other system.

**Improve Scalability** - Helps applications handle higher traffic load efficiently.



## 3. Implementation of Cache in Spring Boot 

Suppose we have a service which is calling the db to fetch some data like below - 

```
@Service
public class WeatherService {

    private final WeatherRepository weatherRepo ;

    @Autowired
    public WeatherService (WeatherRepository weatherRepository) {
        this.weatherRepo = weatherRepository ;
    }


    public String getWeatherByCity (String city) {
        System.out.println("Fetching the data from db");
        Optional <Weather> weather = weatherRepo.findByCity(city);

        return weather.map(Weather::getForcast).orElse(other : "Weather details is unavailable") ;
    }
    
}
```


Now lets see how we can use Cache.

### 3.1. Enable Caching

- To Enable Caching we can use **@EnableCaching** annotation where we defines the configuration class (ie., we can use it along with @SpringBootApplication on the main class).



### 3.2 Use Cache in Service Layer

- To use cache in Service Layer, we can use **@Cacheable** Annotation at the method level.


```
@Service
public class WeatherService {

    private final WeatherRepository weatherRepo ;

    @Autowired
    public WeatherService (WeatherRepository weatherRepository) {
        this.weatherRepo = weatherRepository ;
    }

    @Cacheable("weatherCache")
    public String getWeatherByCity (String city) {
        System.out.println("Fetching the data from db");
        Optional <Weather> weather = weatherRepo.findByCity(city);

        return weather.map(Weather::getForcast).orElse(other : "Weather details is unavailable") ;
    }
    
}
```




Now we can consume this service methods on any of your service like below using **@Cacheable("cache-name")** - 

```
@Service
public class WeatherService {

    private final WeatherRepository weatherRepo ;

    @Autowired
    public WeatherService (WeatherRepository weatherRepository) {
        this.weatherRepo = weatherRepository ;
    }

    @autowired
    public CacheInspectionService cacheinspect ;

    @Cacheable("weatherCache", key="#city")
    public String getWeatherByCity (String city) {

        cacheinspect.printCacheContent("weatherCache") ;
        
        System.out.println("Fetching the data from db");
        Optional <Weather> weather = weatherRepo.findByCity(city);

        return weather.map(Weather::getForcast).orElse("Weather details is unavailable") ;
    }
    
}

```

But if we update any data on the DB, the Cache wouldn't get updated and it will still reflect the old data.

Hence, we need to use **@CachePut("cache-name")** at the update method level like below - 



```
@Service
public class WeatherService {

    private final WeatherRepository weatherRepo ;

    @Autowired
    public WeatherService (WeatherRepository weatherRepository) {
        this.weatherRepo = weatherRepository ;
    }

    @autowired
    public CacheInspectionService cacheinspect ;

    @Cacheable("weatherCache", key="#city")
    public String getWeatherByCity (String city) {

        cacheinspect.printCacheContent("weatherCache") ;
        
        System.out.println("Fetching the data from db");
        Optional <Weather> weather = weatherRepo.findByCity(city);

        return weather.map(Weather::getForcast).orElse("Weather details is unavailable") ;
    }


    @CachePut("weatherCache" , key="#city")
    public String updateCityWeather ( Weather weather ) {
        .....
    }


    
    @CacheEvict("weatherCache" , key="#city")
    public String updateCityWeather ( Weather weather ) {
        .....
    }

    
    
}

```




> Note-
> - **@EnableCaching** - It is a Class level Annotation used on Configuration (main) class to Enable Cache.
> - **@Cacheable( "cache-name", key="#anyKeyName" )** - It is used on Service layer methods to store the data on Cache. 
> - **@CachePut( "cache-name", key="#anyKeyName" )** - It is used to update Cache when we update anything on DB.
> - The key will be needed to avoid inconsistency in the cache data otherwise instead of updating the same cache data, it will create a new entry of updated data on the cache.
> - **@CacheEvict( "cache-name", key="#anyKeyName" )** - This Annotation is used with **@Transactional** annotation to delete the cache data when data gets deleted from db.




## 4. How to check the Cache ?

We can create a simple service like below to check the Cache data.

```
@Service
public class CacheInspectionService {

    public void printCacheContent (String cacheName) {
        Cache cache = cacheManager.getCache( cacheName ) ;

        if( cache != null ){
            System.out.println("Cache Contents : ");
            System.out.println(Objects.requireNonNull(cache.getNativeCache().toString() ) );
        }

    } 

}
```






### 5. Types of Cache

#### 5.1 In Memory Cache

![](./Screenshots/inMemoryCache.png)

- The Problem with In Memory cache is if one node tries to update something on DB, then cache related to node 1 will get updated but rest node cache will be unaffected which will create issue.


#### 5.2 Distributed Cache

![](./Screenshots/distributedCache.png)

- Distributed Cache uses a single cache storage which is generally outside the application and the same cache will be used by every node of application.

- **Redis usually helps**.


## 6. Cache using Redis - Distributed Cache

### What is Redis ?

- Redis cache is an in-memory data store that is often used as a cache to speed up applications by temporarily storing frequently accessed data.